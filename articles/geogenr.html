<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="geogenr">
<title>Generator from American Community Survey (ACS) Geodatabases • geogenr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generator from American Community Survey (ACS) Geodatabases">
<meta property="og:description" content="geogenr">
<meta property="og:image" content="https://josesamos.github.io/geogenr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">geogenr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/geogenr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/geogenr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<link href="geogenr_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="geogenr_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="geogenr_files/viz-1.8.2/viz.js"></script><link href="geogenr_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="geogenr_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generator from American Community Survey (ACS) Geodatabases</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2023-11-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/geogenr/blob/HEAD/vignettes/geogenr.Rmd" class="external-link"><code>vignettes/geogenr.Rmd</code></a></small>
      <div class="d-none name"><code>geogenr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://www.census.gov/programs-surveys/acs" class="external-link">American
Community Survey (ACS)</a> offers geodatabases with geographic
information and associated data of interest to researchers in the area.
The goal of <code>geogenr</code> is to facilitate access to this
information through functions that allow us to select the geodatabases
that interest us, download them, access the information they contain,
filter it and export it in various formats so that we can process it
with other tools if required.</p>
<p>Other packages are available that are very useful to access the same
data, such as <a href="https://CRAN.R-project.org/package=tidycensus" class="external-link"><code>tidycensus</code></a>,
which works in an integrated way with <a href="https://CRAN.R-project.org/package=tigris" class="external-link"><code>tigris</code></a>.
The main characteristics of <code>geogenr</code> that distinguish it
from other proposals are the following:</p>
<ul>
<li><p>it works locally, once available geodatabases are downloaded (can
be downloaded using the package);</p></li>
<li><p>supports access at the level of group of variables integrated in
a layer, instead of at the level of variable or vector of
variables;</p></li>
<li><p>decomposes ACS composite variables into structured
fields;</p></li>
<li><p>allows to directly integrate variables of several years;</p></li>
<li><p>and It allows us to export the data to other formats.</p></li>
</ul>
<p>The rest of this document is structured as follows: First, the
starting data are presented. Then, an illustrative example of how the
package works is developed. Finally, the document ends with
conclusions.</p>
</div>
<div class="section level2">
<h2 id="american-community-survey-5-year-estimates">
<em>American Community Survey 5-Year Estimates</em><a class="anchor" aria-label="anchor" href="#american-community-survey-5-year-estimates"></a>
</h2>
<p>The package is based on the geodatabases available on the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-data.2021.html" class="external-link">TIGER/Line
with Selected Demographic and Economic Data</a> web page. For each year
(as of 2012) a list of geodatabases appears under two sections:</p>
<ul>
<li><p><em>Legal and Administrative Areas</em>;</p></li>
<li><p><em>Statistical Areas</em>.</p></li>
</ul>
<p>These geodatabases bring together geography from the <em>TIGER/Line
Shapefiles</em> and data from the <em>American Community Survey (ACS)
5-year estimates</em>.</p>
<p>Each ACS geodatabase is structured in layers: a geographic layer, a
metadata layer, and the rest are data layers. The data layers have a
matrix form, the rows are indexed by instances of the geographic layer,
the columns by variables defined in the metadata layer, the cells are
numeric values. Here we have an example:</p>
<p><code>GEOID          B01001e1 B01001m1 B01001e2 B01001m2 B01001e3 B01001m3 B01001e4 B01001m4 ...</code></p>
<p><code>16000US0100100      218      165       92      114       10       16       18       30</code></p>
<p><code>16000US0100124     2582       24     1313       98       45       37       14       19</code></p>
<p><code>16000US0100460     4374       24     1963      158      144       76      105       68</code></p>
<p><code>16000US0100484      641      159      326       89       10       17       16       11</code></p>
<p><code>16000US0100676      295      102      143       55        7       11       14       17</code></p>
<p><code>16000US0100820    32878       57    16236      453     1159      257     1151      209</code></p>
<p><code>...</code></p>
<p>Some of the defined variables are shown below.</p>
<p><code>Short_Name Full_Name</code></p>
<p><code>B01001e1   SEX BY AGE: Total: Total Population -- (Estimate)</code></p>
<p><code>B01001m1   SEX BY AGE: Total: Total Population -- (Margin of Error)</code></p>
<p><code>B01001e2   SEX BY AGE: Male: Total Population -- (Estimate)</code></p>
<p><code>B01001m2   SEX BY AGE: Male: Total Population -- (Margin of Error)</code></p>
<p><code>B01001e3   SEX BY AGE: Male: Under 5 years: Total Population -- (Estimate)</code></p>
<p><code>B01001m3   SEX BY AGE: Male: Under 5 years: Total Population -- (Margin of Error)</code></p>
<p><code>B01001e4   SEX BY AGE: Male: 5 to 9 years: Total Population -- (Estimate)</code></p>
<p><code>B01001m4   SEX BY AGE: Male: 5 to 9 years: Total Population -- (Margin of Error)</code></p>
<p><code>...</code></p>
<p>Each variable (<code>Short_Name</code>) corresponds to combinations
of various field values separated by a separator (<code>:</code>),
forming a string (<code>Full_Name</code>). The field name of each value
is not available but the topics included are detailed on the web page <a href="https://www.census.gov/programs-surveys/acs/guidance/subjects.html" class="external-link">Subjects
Included in the Survey</a>. There are tens of thousands of variables of
these characteristics that, in addition to the metadata layer, can be
found on the <a href="https://www.census.gov/programs-surveys/geography/technical-documentation/records-layout/tiger-line-demo-record-layouts.html" class="external-link">TIGER/Line
with Selected Demographic and Economic Data Record Layouts</a> web page.
For each combination of values, one variable associated with the
<em>estimate</em> and another with the <em>margin of error</em> are
defined. Within each layer, variables can be considered in groups,
defined by the first part of the <code>Full Name</code> (for example
<code>UNWEIGHTED SAMPLE HOUSING UNITS</code> and
<code>SEX BY AGE</code>).</p>
<p>A module of <code>geogenr</code> package analyses the components of
<code>Full_name</code>, structuring them in fields; and it allows access
to variables in groups.</p>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<p>To work with this data with the <code>geogenr</code> package we
distinguish three phases:</p>
<ul>
<li><p>obtaining the data,</p></li>
<li><p>data selection,</p></li>
<li><p>and generation of results,</p></li>
</ul>
<p>which are developed below.</p>
<p>Once the result structure is generated, we can export it or define
queries on it.</p>
<div class="section level3">
<h3 id="obtaining-the-data">Obtaining the data<a class="anchor" aria-label="anchor" href="#obtaining-the-data"></a>
</h3>
<p>The data is available in the form of a geodatabase. One geodatabase
for each area in each of the two area groups.</p>
<p>In this example, first, we select and download the ACS geodatabases
using the functions offered by the package. When we have them in the
same folder (they can be distributed in subfolders), we can access the
information they contain to select the one that interests us.</p>
<p>We create an object of class <code>acs_5yr</code>, indicating a
folder where we will download the geodatabases.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/geogenr/">geogenr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/acs_5yr"</span>, package <span class="op">=</span> <span class="st">"geogenr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/acs_5yr.html">acs_5yr</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span></code></pre></div>
<p>We can query the available geodatabases by group, area, subject and
year using the methods offered by the object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_area_groups.html">get_area_groups</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Legal and Administrative Areas" "Statistical Areas"</span></span>
<span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_areas.html">get_areas</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Legal and Administrative Areas"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "American Indian/Alaska Native/Native Hawaiian Area"</span></span>
<span><span class="co">#&gt;  [2] "Alaska Native Regional Corporation"                </span></span>
<span><span class="co">#&gt;  [3] "Congressional District (116th Congress)"           </span></span>
<span><span class="co">#&gt;  [4] "County"                                            </span></span>
<span><span class="co">#&gt;  [5] "Place"                                             </span></span>
<span><span class="co">#&gt;  [6] "Elementary School District"                        </span></span>
<span><span class="co">#&gt;  [7] "Secondary School District"                         </span></span>
<span><span class="co">#&gt;  [8] "Unified School District"                           </span></span>
<span><span class="co">#&gt;  [9] "State"                                             </span></span>
<span><span class="co">#&gt; [10] "State Legislative Districts Upper Chamber"         </span></span>
<span><span class="co">#&gt; [11] "State Legislative Districts Lower Chamber"         </span></span>
<span><span class="co">#&gt; [12] "Code Tabulation Area"</span></span>
<span></span>
<span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_area_years.html">get_area_years</a></span><span class="op">(</span>area <span class="op">=</span> <span class="st">"Alaska Native Regional Corporation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2013" "2014" "2015" "2016" "2017" "2018" "2019" "2020" "2021"</span></span></code></pre></div>
<p>Once we decide the area to work with, we download the files if they
are not already downloaded. There are also functions available to
consult previously downloaded data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ac</span> <span class="op">&lt;-</span> <span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_area_files.html">select_area_files</a></span><span class="op">(</span><span class="st">"Alaska Native Regional Corporation"</span>, <span class="fl">2020</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span></span>
<span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/download_selected_files.html">download_selected_files</a></span><span class="op">(</span>unzip <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE TRUE</span></span></code></pre>
<p>The data is downloaded to the working folder associated with the
object. We can indicate that they are classified by year or by area. We
can also indicate that it will be automatically unzipped once
downloaded. In this case they are explicitly unzipped.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/unzip_files.html">unzip_files</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>With these operations we already have the data available locally.</p>
</div>
<div class="section level3">
<h3 id="data-selection">Data selection<a class="anchor" aria-label="anchor" href="#data-selection"></a>
</h3>
<p>Once unzipped, we can consult the available areas and years.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_available_areas.html">get_available_areas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Alaska Native Regional Corporation"</span></span>
<span></span>
<span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_available_area_years.html">get_available_area_years</a></span><span class="op">(</span>area <span class="op">=</span> <span class="st">"Alaska Native Regional Corporation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020" "2021"</span></span></code></pre></div>
<p>For each area we can query the topics of the available reports.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_available_area_topics.html">get_available_area_topics</a></span><span class="op">(</span><span class="st">"Alaska Native Regional Corporation"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "X01 Age And Sex"                     "X02 Race"                           </span></span>
<span><span class="co">#&gt;  [3] "X03 Hispanic Or Latino Origin"       "X04 Ancestry"                       </span></span>
<span><span class="co">#&gt;  [5] "X05 Foreign Born Citizenship"        "X06 Place Of Birth"                 </span></span>
<span><span class="co">#&gt;  [7] "X07 Migration"                       "X08 Commuting"                      </span></span>
<span><span class="co">#&gt;  [9] "X09 Children Household Relationship" "X10 Grandparents Grandchildren"     </span></span>
<span><span class="co">#&gt; [11] "X11 Household Family Subfamilies"    "X12 Marital Status And History"     </span></span>
<span><span class="co">#&gt; [13] "X13 Fertility"                       "X14 School Enrollment"              </span></span>
<span><span class="co">#&gt; [15] "X15 Educational Attainment"          "X16 Language Spoken At Home"        </span></span>
<span><span class="co">#&gt; [17] "X17 Poverty"                         "X18 Disability"                     </span></span>
<span><span class="co">#&gt; [19] "X19 Income"                          "X20 Earnings"                       </span></span>
<span><span class="co">#&gt; [21] "X21 Veteran Status"                  "X22 Food Stamps"                    </span></span>
<span><span class="co">#&gt; [23] "X23 Employment Status"               "X24 Industry Occupation"            </span></span>
<span><span class="co">#&gt; [25] "X25 Housing Characteristics"         "X26 Group Quarters"                 </span></span>
<span><span class="co">#&gt; [27] "X27 Health Insurance"                "X28 Computer And Internet Use"      </span></span>
<span><span class="co">#&gt; [29] "X99 Imputation"</span></span></code></pre></div>
<p>We can select one or more topics to obtain the reports they
contain.To select them, we create an object of class
<code>acs_5yr_topic</code>. We can also select the years for which
reports are included; by default all available years are considered.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">act</span> <span class="op">&lt;-</span> <span class="va">ac</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_acs_5yr_topic.html">as_acs_5yr_topic</a></span><span class="op">(</span><span class="st">"Alaska Native Regional Corporation"</span>,</span>
<span>                   topic <span class="op">=</span> <span class="st">"X01 Age And Sex"</span><span class="op">)</span></span></code></pre></div>
<p>Once a topic has been selected, we can consult the available reports
or subreports.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">act</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_report_names.html">get_report_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "B01001-Sex By Age"        "B01002-Median Age By Sex"</span></span>
<span><span class="co">#&gt; [3] "B01003-Total Population"</span></span></code></pre></div>
<p>We can focus on a report or subreport, we can also work with all the
reports contained in the topic.</p>
<p>In this case we are going to work with the entire topic.</p>
</div>
<div class="section level3">
<h3 id="generation-of-results">Generation of results<a class="anchor" aria-label="anchor" href="#generation-of-results"></a>
</h3>
<p>Once we have obtained a group of reports, we can obtain the
associated data in various formats.</p>
<div class="section level4">
<h4 id="acs_5yr_geo-class-format">
<code>acs_5yr_geo</code> class format<a class="anchor" aria-label="anchor" href="#acs_5yr_geo-class-format"></a>
</h4>
<p>In this format, three layers are defined:</p>
<ul>
<li>
<code>data</code> with geographical information and and the names
and values of the variables for each instance,</li>
<li>
<code>metadata</code> with the description of the variables,</li>
<li>
<code>origin</code> with the metadata about the origin of the
data.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo</span> <span class="op">&lt;-</span> <span class="va">act</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_acs_5yr_geo.html">as_acs_5yr_geo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This format allows us to perform simple queries using the metadata
and the geographic layer.</p>
<p>We obtain and consult the content of the metadata: structured
description of the variables.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,436 × 12</span></span></span>
<span><span class="co">#&gt;    variable year  Short_Name Full_Name   report subreport report_var report_desc</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> V0001    2020  B01001Ae1  Sex By Age… B01001 A                  1 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> V0002    2020  B01001Ae10 Sex By Age… B01001 A                 10 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> V0003    2020  B01001Ae11 Sex By Age… B01001 A                 11 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> V0004    2020  B01001Ae12 Sex By Age… B01001 A                 12 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> V0005    2020  B01001Ae13 Sex By Age… B01001 A                 13 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> V0006    2020  B01001Ae14 Sex By Age… B01001 A                 14 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> V0007    2020  B01001Ae15 Sex By Age… B01001 A                 15 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> V0008    2020  B01001Ae16 Sex By Age… B01001 A                 16 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> V0009    2020  B01001Ae17 Sex By Age… B01001 A                 17 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> V0010    2020  B01001Ae18 Sex By Age… B01001 A                 18 Sex By Age…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,426 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: measure &lt;chr&gt;, item1 &lt;chr&gt;, item2 &lt;chr&gt;, group &lt;chr&gt;</span></span></span></code></pre></div>
<p>We filter the metadata using the functions of the <code>dplyr</code>
package.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">metadata</span>,</span>
<span>    <span class="va">item2</span> <span class="op">==</span> <span class="st">"Female"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">group</span> <span class="op">==</span> <span class="st">"People Who Are American Indian And Alaska Native Alone"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"estimate"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We obtain a new object whose data corresponds to the metadata that we
have obtained as a result of the selection operations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo2</span> <span class="op">&lt;-</span> <span class="va">geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_metadata.html">set_metadata</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geo2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 12</span></span></span>
<span><span class="co">#&gt;   variable year  Short_Name Full_Name    report subreport report_var report_desc</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> V0671    2020  B01002Ce3  Median Age … B01002 C                  3 Median Age…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> V1389    2021  B01002Ce3  Median Age … B01002 C                  3 Median Age…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: measure &lt;chr&gt;, item1 &lt;chr&gt;, item2 &lt;chr&gt;, group &lt;chr&gt;</span></span></span></code></pre></div>
<p>We work with the new object, for example, by defining a new variable
and graphing it using the associated geographic data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo_layer</span> <span class="op">&lt;-</span> <span class="va">geo2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_geo_layer.html">get_geo_layer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geo_layer</span><span class="op">$</span><span class="va">faiana21vs20</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">geo_layer</span><span class="op">$</span><span class="va">V1389</span> <span class="op">-</span> <span class="va">geo_layer</span><span class="op">$</span><span class="va">V0671</span><span class="op">)</span> <span class="op">/</span> <span class="va">geo_layer</span><span class="op">$</span><span class="va">V0671</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_shift_longitude.html" class="external-link">st_shift_longitude</a></span><span class="op">(</span><span class="va">geo_layer</span><span class="op">[</span>, <span class="st">"faiana21vs20"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="geogenr_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Additionally, we can export any of these objects in
<code>GeoPackage</code> format to use other query tools, such as
<em>QGIS</em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="va">geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_GeoPackage.html">as_GeoPackage</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: GPKG </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;   layer_name geometry_type features fields crs_name</span></span>
<span><span class="co">#&gt; 1       data Multi Polygon       12   1453    NAD83</span></span>
<span><span class="co">#&gt; 2   metadata            NA     1436     12     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3     origin            NA        2      6     &lt;NA&gt;</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rolap-package-objects">
<code>rolap</code> package objects<a class="anchor" aria-label="anchor" href="#rolap-package-objects"></a>
</h4>
<p>We can export reports from a theme as <code>flat_table</code> or
<code>star_database</code> objects from the <a href="https://cran.r-project.org/package=rolap" class="external-link"><code>rolap</code></a>
package, which allow us to enrich them with additional information or
work directly with OLAP tools.</p>
<p>We are going to export them as an object of the
<code>star_database</code> class.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st</span> <span class="op">&lt;-</span> <span class="va">act</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_star_database.html">as_star_database</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Below are the tables that make up the star ROLAP design obtained.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_dm</span> <span class="op">&lt;-</span> <span class="va">st</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="https://josesamos.github.io/rolap/reference/as_dm_class.html" class="external-link">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">st_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>rankdir <span class="op">=</span> <span class="st">"LR"</span>, view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"anrc\" [id = \"anrc\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">anrc<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"dim_when_key\">dim_when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"dim_where_key\">dim_where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"dim_what_key\">dim_what_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">estimate<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">margin_of_error<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"dim_what\" [id = \"dim_what\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">dim_what<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"dim_what_key\"><U>dim_what_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">short_name<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">full_name<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">report<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">subreport<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">report_var<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">report_desc<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">item_1<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">item_2<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">group<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"dim_when\" [id = \"dim_when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">dim_when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"dim_when_key\"><U>dim_when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"dim_where\" [id = \"dim_where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">dim_where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"dim_where_key\"><U>dim_where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">statefp<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">anrcfp<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">anrcns<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">geoid<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">name<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">namelsad<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">lsad<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">classfp<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">mtfcc<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">geoid_data<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"anrc\":\"dim_when_key\"->\"dim_when\":\"dim_when_key\" [id=\"anrc_1\"]\n\"anrc\":\"dim_where_key\"->\"dim_where\":\"dim_where_key\" [id=\"anrc_2\"]\n\"anrc\":\"dim_what_key\"->\"dim_what\":\"dim_what_key\" [id=\"anrc_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>We also show the number of instances of each table.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l_db</span> <span class="op">&lt;-</span> <span class="va">st</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="https://josesamos.github.io/rolap/reference/as_tibble_list.html" class="external-link">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">l_db</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="va">names</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"name: %s, %d rows\n"</span>, <span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">l_db</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; name: anrc, 8572 rows</span></span>
<span><span class="co">#&gt; name: dim_what, 359 rows</span></span>
<span><span class="co">#&gt; name: dim_when, 2 rows</span></span>
<span><span class="co">#&gt; name: dim_where, 12 rows</span></span></code></pre></div>
<p>We can also export it to any RDBMS.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>The <a href="https://www.census.gov/programs-surveys/acs" class="external-link">American
Community Survey (ACS)</a> offers geodatabases with geographic
information and associated data of interest to researchers in the area.
These data can be accessed through various alternatives in which we must
indicate the year and variable names. Due to the large number of
variables and their structure, this operation is not easy.</p>
<p>The <code>geogenr</code> package offers an alternative that allows us
to download the geodatabases that are considered necessary and access
the variables by selecting data layers and logical groups of variables.
Additionally, it allows us to obtain data in various formats to consult
them directly or use other tools.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
